{% extends 'main.html' %}

{% block content %}

<style>
    .telegram-settings-container{
      display: grid;
      grid-template-columns: 1fr 6fr 1fr;
  
    }
    .group-container3{
    display: grid;
    grid-template-columns: 3fr 7fr;
  }
  .hidden{
    display: none
  }
</style>



<div class="telegram-settings-container">
    <div></div>
    <div>
        {% if message %}
            <p>{{ message }}</p>
        {% endif %}
        <form action="." method="POST">
            {% csrf_token %}
            {{ form.as_p }}

            {% if formset %}
            <h3>Set your weekly squedules</h3>
            <div class="group-container3">
                <div>
                  <span style="float:left">  
                    <p><input type="checkbox" id="el" checked></input>Seg</p>
                  </span>
                  {{ formset.management_form }}
                  <span style="float:right" id="monday-form-list">
                    {% for form in formset %}
                      {{ form.id }}
                      <div class= "monday-form">
                        <p>{{ form.start_time }} - {{ form.end_time }}</p> 
                        <p></p>
                      </div>
                      <h4 id="text" style="display:none">unavailable</h4>
                    {% endfor %}
                
                    <div id="empty-form" class="hidden">
                      <p>{{ formset.empty_form.start_time }} - {{ formset.empty_form.end_time }} </p>
                    </div> 
                  </span> 
                </div>
                <div></div>
              </div>
            {% endif %}
            
            <button type="button" id="add-more">Add</button>
            <p><button type="submit" id="save_btn" name="emptylayerbtn">Save</button></p>
        </form>
    </div>
    <div></div>
    
</div>


{% endblock content %}

{% block javascript %}

<script>

const addMoreBtn = document.getElementById('add-more')


document.addEventListener('click', (event)=>{
  if (event.target.id == 'add-more') {
    add_new_form(event)
  }
})

//addMoreBtn.addEventListener('click', (add_new_form))

function add_new_form(event) {
  if (event) {
    event.preventDefault()
  }
  const totalNewForms = document.getElementById('id_form-TOTAL_FORMS')
  const currentMondayForms = document.getElementsByClassName('monday-form')
  const currentFormCount = currentMondayForms.length 
  const formCopyTarget = document.getElementById('monday-form-list')
  const copyemptyFormEl = document.getElementById('empty-form').cloneNode(true)
  const deleteBtn = document.getElementById('delete')
  copyemptyFormEl.setAttribute('class', 'monday-form')
  copyemptyFormEl.setAttribute('id', `form-${currentFormCount}`)
  const regex = new RegExp('__prefix__', 'g')
  copyemptyFormEl.innerHTML = copyemptyFormEl.innerHTML.replace(regex, currentFormCount)
  totalNewForms.setAttribute('value', currentFormCount + 1)
  formCopyTarget.append(copyemptyFormEl)
}

const alertStatus = (e) => {
  var text = document.getElementById("text");
  const currentMondayForms = document.getElementsByClassName('monday-form')  
  const addMoreBtn = document.getElementById('add-more')
  if ($("#el").is(":checked")) {
    $(currentMondayForms).show();
    $(addMoreBtn).show();
    text.style.display = "none";
  } else {
    $(currentMondayForms).hide();
    $(addMoreBtn).hide();
    text.style.display = "block";
  }
};

  $(document).on("click", "#el", alertStatus);

</script>

{% endblock %}